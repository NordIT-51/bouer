#!/bin/bash

# Функция для создания таблицы смещений
function create_shift_table {
    local pattern=$1
    local pattern_len=${#pattern}
    local shift_table=()

    # Инициализируем таблицу смещений значением длины паттерна
    for ((i=0; i<256; i++)); do
        shift_table[$i]=$pattern_len
    done

    # Заполняем таблицу смещений для символов в паттерне
    for ((i=0; i<$pattern_len-1; i++)); do
        ascii_val=$(printf "%d" "'${pattern:i:1}")
        shift_table[$ascii_val]=$((pattern_len - i - 1))
    done

    echo ${shift_table[@]}
}

# Функция для поиска паттерна в тексте с помощью алгоритма Бойера-Мура
function boyer_moore_search {
    local text=$1
    local pattern=$2
    local text_len=${#text}
    local pattern_len=${#pattern}
    local shift_table=($(create_shift_table $pattern))
    local i=$pattern_len
    local j

    while ((i <= text_len)); do
        j=$pattern_len

        # Проверяем символы с конца паттерна до его начала
        while ((j > 0)) && [[ ${text:i-1:1} == ${pattern:j-1:1} ]]; do
            ((i--))
            ((j--))
        done

        if ((j == 0)); then
            echo "Паттерн найден в позиции $i"
            return
        else
            ascii_val=$(printf "%d" "'${text:i-1:1}")
            shift=$((pattern_len - j))
            shift_table_val=${shift_table[$ascii_val]}
            
            # Выбираем максимальное смещение из таблицы смещений и текущего смещения
            if ((shift > shift_table_val)); then
                ((i += shift))
            else
                ((i += shift_table_val))
            fi
        fi
    done

    echo "Паттерн не найден"
}

# Пример использования
text=$1
pattern=$2
echo "Строка: $text"
echo "Искомая последовательность: $pattern"
boyer_moore_search $text $pattern
